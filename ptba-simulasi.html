<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Simulasi Risiko Iklim PTBA - U-Shape Model</title>
    <style>
        /* --- RESET & LAYOUT UTAMA --- */
        * { box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            background: #f0f2f5; 
            margin: 0; padding: 0;
            height: 100vh; /* Kunci tinggi layar */
            width: 100vw;
            display: flex; justify-content: center; align-items: center;
            overflow: hidden; /* Mencegah scroll bar muncul */
            color: #333;
        }

        /* Container Utama sebagai Flex Column agar isi menyesuaikan tinggi */
        .dashboard { 
            background: white; 
            width: 100%; max-width: 1000px;
            height: 100%; max-height: 100%; /* Full Height di HP */
            display: flex; flex-direction: column;
            padding: 15px; 
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        /* --- HEADER & KREDIT (Compact) --- */
        .header-section { flex: 0 0 auto; text-align: center; margin-bottom: 10px; }
        h2 { margin: 5px 0; color: #2c3e50; font-size: 1.4rem; }
        .subtitle { margin: 0; color: #7f8c8d; font-size: 0.9rem; }
        
        .credits-line { font-size: 0.75rem; color: #888; margin-top: 5px; border-top: 1px solid #eee; padding-top: 5px; }
        .credits-author { font-weight: 700; color: #444; }
        .credits-link { color: #27ae60; text-decoration: none; }

        /* --- VISUALISASI (Flex Grow untuk mengisi ruang kosong) --- */
        .risk-container { 
            flex: 1 1 auto; /* Mengisi sisa ruang vertikal */
            display: flex; 
            gap: 10px; 
            min-height: 0; /* Penting agar flex item bisa mengecil */
            margin-bottom: 10px;
        }

        .zone { 
            flex: 1; /* Bagi dua rata kiri-kanan */
            border: 2px solid #e0e0e0; 
            border-radius: 10px; 
            position: relative; 
            overflow: hidden; 
            background: #eef2f3;
        }
        
        /* Label dalam gambar */
        .label { 
            position: absolute; top: 10px; left: 50%; transform: translateX(-50%); 
            background: rgba(255,255,255,0.9); padding: 4px 10px; border-radius: 15px; 
            font-size: 0.8rem; font-weight: bold; color: #444; white-space: nowrap; z-index: 20;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* --- ELEMENT GRAFIS --- */
        /* Tambang (Kiri) */
        .pit-bg { position: absolute; bottom: 0; width: 100%; height: 100%; background: repeating-linear-gradient(45deg, #795548, #795548 10px, #6d4c41 10px, #6d4c41 20px); clip-path: polygon(0 0, 100% 0, 100% 100%, 80% 80%, 20% 80%, 0 100%); opacity: 0.8; }
        .truck { position: absolute; bottom: 22%; left: 50%; transform: translateX(-50%); font-size: 3rem; z-index: 5; transition: bottom 0.3s; }
        .water-pit { position: absolute; bottom: 0; width: 100%; background: linear-gradient(to top, #2980b9, #3498db); opacity: 0.85; transition: height 0.5s; z-index: 6; border-top: 2px solid #aed6f1; }

        /* Sungai (Kanan) */
        .river-bed { position: absolute; bottom: 0; width: 100%; height: 20%; background: #5d4037; z-index: 1; border-top: 2px solid #4e342e; }
        .water-river { position: absolute; bottom: 20%; width: 100%; background: linear-gradient(to top, #2980b9, #3498db); opacity: 0.8; transition: height 0.5s; z-index: 2; border-top: 2px solid #aed6f1; }
        .barge { position: absolute; left: 50%; transform: translateX(-50%); font-size: 3.5rem; transition: bottom 0.5s, transform 0.5s; z-index: 5; }

        /* Hujan */
        .rain { position: absolute; inset: 0; pointer-events: none; display: none; z-index: 8; }
        .drop { position: absolute; width: 2px; height: 10px; background: blue; animation: fall 0.4s linear infinite; }
        @keyframes fall { to { transform: translateY(100vh); opacity: 0; } }

        /* --- KETERANGAN (Captions) --- */
        /* Kita buat caption menyatu/compact di bawah gambar */
        .caption-section {
            flex: 0 0 auto;
            display: flex; gap: 10px; margin-bottom: 10px;
        }
        .caption-box {
            flex: 1; 
            font-size: 0.75rem; line-height: 1.2; 
            padding: 8px; border-radius: 8px; background: #fff; border: 1px solid #ddd;
            display: flex; flex-direction: column; justify-content: center;
        }
        .caption-title { font-weight: bold; margin-bottom: 3px; font-size: 0.8rem; }
        
        /* Warna Caption Aktif (Visual Cue) */
        .caption-box.active-wet { border: 2px solid #3498db; background-color: #f0f8ff; }
        .caption-box.active-dry { border: 2px solid #e74c3c; background-color: #fff5f5; }

        /* --- KONTROL (Fixed Height) --- */
        .control-panel { 
            flex: 0 0 auto; 
            background: #f8f9fa; padding: 15px; border-radius: 12px; border: 1px solid #e9ecef; text-align: center; 
        }
        
        /* Slider Styling */
        input[type=range] { width: 100%; margin: 10px 0; cursor: pointer; height: 6px; background: #ccc; border-radius: 5px; outline: none; -webkit-appearance: none; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 22px; height: 22px; background: #2c3e50; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }

        .status-box { 
            padding: 10px; border-radius: 8px; color: white; font-weight: bold; margin-bottom: 5px; 
            font-size: 0.95rem; transition: background 0.3s;
        }
        .status-normal { background: #27ae60; }
        .status-dry { background: #c0392b; }
        .status-wet { background: #2980b9; }
        .status-warn-wet { background: #e67e22; }
        .status-warn-dry { background: #f39c12; }

        #financialImpact { font-size: 0.9rem; font-weight: 600; color: #444; margin: 0; }

        /* --- RESPONSIVE MOBILE TWEAKS --- */
        @media (max-width: 600px) {
            .dashboard { padding: 10px; border-radius: 0; max-height: 100vh; }
            h2 { font-size: 1.1rem; }
            .subtitle { font-size: 0.75rem; display: none; /* Hide subtitle on tiny screens to save space */ }
            
            /* Gambar tetap side-by-side tapi ikon dikecilkan */
            .truck { font-size: 2rem; }
            .barge { font-size: 2.5rem; }
            
            /* Sembunyikan teks caption panjang di HP, ganti indikator simpel */
            .caption-text { display: none; } 
            .caption-title { font-size: 0.7rem; text-align: center; margin: 0; }
            .caption-box { padding: 5px; text-align: center; }
            
            /* Kontrol lebih padat */
            .control-panel { padding: 10px; }
            .status-box { font-size: 0.85rem; padding: 8px; }
        }
    </style>
</head>
<body>

    <div class="dashboard">
        
        <div class="header-section">
            <div class="credits-line">
                <span class="credits-author">Created by Leonard Tiopan Panjaitan, MT, CSRA, CGPS, CPS</span><br>
                Supported by <a href="https://greenproductivity.online" class="credits-link">greenproductivity.online</a>
            </div>
            <h2>PTBA Climate Risk Stress Test</h2>
            <p class="subtitle">Geser slider untuk melihat dampak "U-Shape" (Kering vs Basah)</p>
        </div>

        <div class="risk-container">
            <div class="zone" id="zone-mine">
                <div class="label">AREA TAMBANG</div>
                <div class="pit-bg"></div>
                <div class="truck">üöõ</div>
                <div class="water-pit" id="pitWater" style="height: 0%;"></div>
                <div class="rain" id="rainEffect"></div>
            </div>

            <div class="zone" id="zone-river">
                <div class="label">LOGISTIK SUNGAI</div>
                <div class="water-river" id="riverWater" style="height: 50%;"></div>
                <div class="river-bed"></div>
                <div class="barge" id="bargeShip" style="bottom: 60%;">üö¢</div> 
            </div>
        </div>

        <div class="caption-section">
            <div class="caption-box" id="cap-wet">
                <div class="caption-title">üåßÔ∏è RISIKO BASAH</div>
                <div class="caption-text">Banjir Tambang (Pit Flooding) & Jalan Licin. Produksi terhenti.</div>
            </div>
            <div class="caption-box" id="cap-dry">
                <div class="caption-title">‚òÄÔ∏è RISIKO KERING</div>
                <div class="caption-text">Sungai Surut (Grounding). Logistik tongkang terhambat/stop.</div>
            </div>
        </div>

        <div class="control-panel">
            <div style="display:flex; justify-content:space-between; font-size:0.9rem; font-weight:bold; margin-bottom:5px;">
                <span>Kering (0.1)</span>
                <span style="color:#2980b9;">Inflow Ratio: <span id="ratioVal">1.0</span></span>
                <span>Basah (2.5)</span>
            </div>
            
            <input type="range" id="inflowSlider" min="0.1" max="2.5" step="0.1" value="1.0">
            
            <div id="statusBox" class="status-box status-normal">
                NORMAL: OPERASI OPTIMAL
            </div>
            <p id="financialImpact">Est. Revenue Loss: IDR 0</p>
        </div>
    </div>

    <script>
        const slider = document.getElementById('inflowSlider');
        const ratioDisplay = document.getElementById('ratioVal');
        const pitWater = document.getElementById('pitWater');
        const riverWater = document.getElementById('riverWater');
        const barge = document.getElementById('bargeShip');
        const statusBox = document.getElementById('statusBox');
        const financeText = document.getElementById('financialImpact');
        const rainEffect = document.getElementById('rainEffect');
        const capWet = document.getElementById('cap-wet');
        const capDry = document.getElementById('cap-dry');

        updateSimulation(1.0);

        slider.addEventListener('input', function() {
            updateSimulation(parseFloat(this.value));
        });

        function updateSimulation(ratio) {
            ratioDisplay.innerText = ratio.toFixed(1);

            // --- LOGIKA SUNGAI (KANAN) ---
            let riverH = 50; 
            if(ratio < 1.0) riverH = Math.max(2, ratio * 50); 
            else riverH = 50 + (ratio-1)*15; 
            
            riverWater.style.height = riverH + "%";

            let waterSurface = 20 + riverH; // 20% is bed height
            let bargeDraft = 12; 
            let idealBottom = waterSurface - bargeDraft;
            let actualBottom = Math.max(20, idealBottom); // Grounding check
            barge.style.bottom = actualBottom + "%";

            // --- LOGIKA TAMBANG (KIRI) ---
            let pitH = 0;
            if(ratio > 1.4) {
                pitH = (ratio - 1.4) * 75; 
                rainEffect.style.display = 'block';
                createRain();
            } else {
                rainEffect.style.display = 'none';
                rainEffect.innerHTML = ''; 
            }
            pitWater.style.height = Math.min(100, pitH) + "%";

            // --- UPDATE STATUS & CAPTION HIGHLIGHT ---
            updateStatus(ratio, actualBottom);
        }

        function updateStatus(ratio, bargePos) {
            // Reset Styles
            barge.style.transform = "translateX(-50%) rotate(0deg)";
            capWet.className = "caption-box"; // Reset highlight
            capDry.className = "caption-box";

            if (ratio <= 0.4) {
                // KERING
                statusBox.className = "status-box status-dry";
                statusBox.innerText = "BAHAYA: EKSTREM KERING";
                financeText.innerHTML = "Loss: <strong>IDR 416 Miliar</strong> (Logistik Stop)";
                if (bargePos <= 20.5) barge.style.transform = "translateX(-50%) rotate(-5deg)";
                capDry.classList.add("active-dry");
            } 
            else if (ratio >= 2.1) {
                // BASAH PARAH
                statusBox.className = "status-box status-wet";
                statusBox.innerText = "BAHAYA: BANJIR TAMBANG";
                financeText.innerHTML = "Loss: <strong>IDR 1.66 Triliun</strong> (Produksi Stop)";
                capWet.classList.add("active-wet");
            }
            else if (ratio >= 1.5) {
                // WASPADA BASAH
                statusBox.className = "status-box status-warn-wet"; 
                statusBox.innerText = "WASPADA: SANGAT BASAH";
                financeText.innerHTML = "Loss: <strong>IDR 666 Miliar</strong> (Jalan Licin)";
                capWet.classList.add("active-wet");
            }
            else if (ratio < 0.8) {
                 // WASPADA KERING
                 statusBox.className = "status-box status-warn-dry"; 
                 statusBox.innerText = "WASPADA: SUNGAI SURUT";
                 financeText.innerHTML = "Loss: <strong>IDR 100-200 M</strong> (Light Loading)";
                 capDry.classList.add("active-dry");
            }
            else {
                // NORMAL
                statusBox.className = "status-box status-normal";
                statusBox.innerText = "NORMAL: OPERASI OPTIMAL";
                financeText.innerHTML = "Loss: <strong>IDR 0</strong>";
            }
        }

        function createRain() {
            if(rainEffect.childElementCount > 20) return;
            for(let i=0; i<3; i++){
                let drop = document.createElement('div');
                drop.className = 'drop';
                drop.style.left = Math.random() * 100 + '%';
                drop.style.animationDuration = (Math.random() * 0.5 + 0.3) + 's';
                rainEffect.appendChild(drop);
            }
        }
    </script>
</body>
</html>
