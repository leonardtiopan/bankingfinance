<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulasi Risiko Iklim PTBA - U-Shape Model - created by Leonard Tiopan Panjaitan, MT, CGPS, GPS - 30 December 2025</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .dashboard { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); max-width: 800px; width: 100%; }
        h2 { text-align: center; color: #2c3e50; margin-bottom: 5px; }
        p.subtitle { text-align: center; color: #7f8c8d; margin-bottom: 30px; font-size: 0.9em; }
        
        /* Layout Grid */
        .risk-container { display: flex; justify-content: space-between; gap: 20px; margin-bottom: 30px; height: 300px; }
        .zone { flex: 1; border: 1px solid #ddd; border-radius: 10px; position: relative; overflow: hidden; background: #eef2f3; }
        
        /* Labels */
        .label { position: absolute; top: 10px; left: 0; right: 0; text-align: center; font-weight: bold; color: #555; z-index: 10; background: rgba(255,255,255,0.8); padding: 5px; }

        /* MINE PIT (Kiri) */
        .pit-bg { position: absolute; bottom: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #8e44ad 0%, #3498db 100%); clip-path: polygon(0 0, 100% 0, 100% 100%, 80% 80%, 20% 80%, 0 100%); background: #795548; }
        .truck { position: absolute; bottom: 25%; left: 40%; font-size: 40px; transition: transform 0.5s; z-index: 5; }
        .water-pit { position: absolute; bottom: 0; width: 100%; background: rgba(52, 152, 219, 0.8); transition: height 0.5s cubic-bezier(0.4, 0, 0.2, 1); z-index: 6; border-top: 2px solid #2980b9; }

        /* RIVER (Kanan) */
        .river-bed { position: absolute; bottom: 0; width: 100%; height: 20%; background: #5d4037; z-index: 1; }
        .water-river { position: absolute; bottom: 20%; width: 100%; background: rgba(41, 128, 185, 0.7); transition: height 0.5s cubic-bezier(0.4, 0, 0.2, 1); z-index: 2; border-top: 2px solid #fff; }
        .barge { position: absolute; bottom: 20%; left: 30%; font-size: 50px; transition: bottom 0.5s cubic-bezier(0.4, 0, 0.2, 1); z-index: 5; }
        
        /* Slider Control */
        .control-panel { background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center; }
        input[type=range] { width: 80%; margin: 15px 0; cursor: pointer; }
        .value-display { font-size: 1.2em; font-weight: bold; color: #2980b9; }
        
        /* Status Bar */
        .status-box { margin-top: 20px; padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; color: white; transition: background 0.3s; }
        .status-normal { background: #27ae60; }
        .status-dry { background: #e74c3c; }
        .status-wet { background: #c0392b; }
        
        /* Rain Animation */
        .rain { position: absolute; width: 100%; height: 100%; pointer-events: none; display: none; z-index: 8; }
        .drop { position: absolute; width: 2px; height: 10px; background: blue; animation: fall 0.5s linear infinite; }
        @keyframes fall { to { transform: translateY(300px); } }

    </style>
</head>
<body>

    <div class="dashboard">
        <h2>PTBA Climate Risk Stress Test</h2>
        <p class="subtitle">Model Simulasi "U-Shape": Dampak Inflow Ratio terhadap Tambang & Logistik</p>

        <div class="risk-container">
            <div class="zone" id="zone-mine">
                <div class="label">AREA TAMBANG (PIT)</div>
                <div class="pit-bg"></div>
                <div class="truck">ðŸš›</div> <div class="water-pit" id="pitWater" style="height: 0%;"></div>
                <div class="rain" id="rainEffect"></div>
            </div>

            <div class="zone" id="zone-river">
                <div class="label">LOGISTIK SUNGAI MUSI</div>
                <div class="water-river" id="riverWater" style="height: 50%;"></div>
                <div class="river-bed"></div>
                <div class="barge" id="bargeShip">ðŸš¢</div> </div>
        </div>

        <div class="control-panel">
            <label>Geser Inflow Ratio (Curah Hujan): <span id="ratioVal" class="value-display">1.0</span></label><br>
            <input type="range" id="inflowSlider" min="0.1" max="2.5" step="0.1" value="1.0">
            
            <div id="statusBox" class="status-box status-normal">
                STATUS: NORMAL (Operasi Optimal)
            </div>
            <p id="financialImpact" style="margin-top:10px; font-size:0.9em; color:#555;">Est. Revenue Loss: IDR 0 Miliar</p>
        </div>
    </div>

    <script>
        const slider = document.getElementById('inflowSlider');
        const ratioDisplay = document.getElementById('ratioVal');
        const pitWater = document.getElementById('pitWater');
        const riverWater = document.getElementById('riverWater');
        const barge = document.getElementById('bargeShip');
        const statusBox = document.getElementById('statusBox');
        const financeText = document.getElementById('financialImpact');
        const rainEffect = document.getElementById('rainEffect');

        // Fungsi Update Visualisasi
        slider.oninput = function() {
            let ratio = parseFloat(this.value);
            ratioDisplay.innerText = ratio.toFixed(1);

            // LOGIKA VISUALISASI
            
            // 1. Sungai Musi (Kanan)
            // Normal level = 50% height. Kering < 0.5 ratio
            let riverH = 50; 
            if(ratio < 1.0) riverH = Math.max(10, ratio * 50); // Turun drastis jika kering
            else riverH = 50 + (ratio-1)*10; // Naik sedikit jika hujan
            
            riverWater.style.height = riverH + "%";
            // Posisi Tongkang mengikuti air (tapi jangan tembus dasar)
            // Dasar sungai ada di height 20%. Jadi min bottom tongkang = 20%.
            let bargeBottom = Math.max(20, 20 + riverH - 20 - 5); 
            barge.style.bottom = bargeBottom + "%";

            // 2. Tambang / Pit (Kiri)
            // Normal = Kering (0%). Mulai banjir jika ratio > 1.5
            let pitH = 0;
            if(ratio > 1.4) {
                pitH = (ratio - 1.4) * 80; // Air naik cepat
                rainEffect.style.display = 'block';
                createRain();
            } else {
                rainEffect.style.display = 'none';
                rainEffect.innerHTML = ''; // Stop rain
            }
            pitWater.style.height = pitH + "%";

            // 3. Status & Finansial (Sesuai Excel Anda)
            updateStatus(ratio);
        }

        function updateStatus(ratio) {
            if (ratio <= 0.3) {
                statusBox.className = "status-box status-dry";
                statusBox.innerText = "BAHAYA: EKSTREM KERING (Tongkang Kandas)";
                financeText.innerText = "Est. Revenue Loss: IDR 416 Miliar (Logistik Terhenti)";
                barge.style.transform = "rotate(-10deg)"; // Tongkang miring
            } 
            else if (ratio > 2.0) {
                statusBox.className = "status-box status-wet";
                statusBox.innerText = "BAHAYA: BANJIR TAMBANG (Produksi Stop)";
                financeText.innerText = "Est. Revenue Loss: IDR 1.66 Triliun (Pit Flooding)";
                barge.style.transform = "rotate(0deg)";
            }
            else if (ratio >= 1.6) {
                statusBox.className = "status-box status-wet"; // Kuning/Oranye
                statusBox.style.background = "#e67e22";
                statusBox.innerText = "WASPADA: SANGAT BASAH";
                financeText.innerText = "Est. Revenue Loss: IDR 666 Miliar (Slippery Road)";
                barge.style.transform = "rotate(0deg)";
            }
            else {
                statusBox.className = "status-box status-normal";
                statusBox.innerText = "NORMAL: OPERASI OPTIMAL";
                financeText.innerText = "Est. Revenue Loss: IDR 0";
                barge.style.transform = "rotate(0deg)";
            }
        }

        function createRain() {
            // Simple rain generator
            if(rainEffect.childElementCount > 20) return; // Limit drops
            for(let i=0; i<5; i++){
                let drop = document.createElement('div');
                drop.className = 'drop';
                drop.style.left = Math.random() * 100 + '%';
                drop.style.animationDuration = (Math.random() * 0.5 + 0.2) + 's';
                rainEffect.appendChild(drop);
            }
        }
    </script>
</body>
</html>
